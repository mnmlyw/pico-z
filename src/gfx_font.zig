// PICO-8 built-in font: 4x6 pixel glyphs for ASCII 0-127
// Each glyph is stored as 3 bytes (6 rows x 4 bits = 24 bits)
// Row 0 is in the high nibble of byte 0, row 1 in the low nibble, etc.
// Within each nibble, bit 3 = leftmost pixel, bit 0 = rightmost pixel

pub const font_data: [128][3]u8 = init: {
    var data: [128][3]u8 = .{.{ 0, 0, 0 }} ** 128;

    // Space and basic punctuation
    data[32] = .{ 0x00, 0x00, 0x00 }; // space
    data[33] = .{ 0x44, 0x40, 0x40 }; // !
    data[34] = .{ 0xAA, 0x00, 0x00 }; // "
    data[35] = .{ 0xAF, 0xAF, 0xA0 }; // #
    data[36] = .{ 0x4E, 0xC2, 0xE4 }; // $ (simplified)
    data[37] = .{ 0xA2, 0x44, 0x8A }; // %
    data[38] = .{ 0x4A, 0x4A, 0x50 }; // &
    data[39] = .{ 0x44, 0x00, 0x00 }; // '
    data[40] = .{ 0x24, 0x44, 0x20 }; // (
    data[41] = .{ 0x84, 0x44, 0x80 }; // )
    data[42] = .{ 0xA4, 0xEA, 0x40 }; // *
    data[43] = .{ 0x04, 0xE4, 0x00 }; // +
    data[44] = .{ 0x00, 0x00, 0x48 }; // ,
    data[45] = .{ 0x00, 0xE0, 0x00 }; // -
    data[46] = .{ 0x00, 0x00, 0x40 }; // .
    data[47] = .{ 0x22, 0x44, 0x80 }; // /

    // Digits 0-9
    data['0'] = .{ 0xEA, 0xAA, 0xE0 };
    data['1'] = .{ 0x4C, 0x44, 0xE0 };
    data['2'] = .{ 0xE2, 0xE8, 0xE0 };
    data['3'] = .{ 0xE2, 0xE2, 0xE0 };
    data['4'] = .{ 0xAA, 0xE2, 0x20 };
    data['5'] = .{ 0xE8, 0xE2, 0xE0 };
    data['6'] = .{ 0xE8, 0xEA, 0xE0 };
    data['7'] = .{ 0xE2, 0x24, 0x40 };
    data['8'] = .{ 0xEA, 0xEA, 0xE0 };
    data['9'] = .{ 0xEA, 0xE2, 0xE0 };

    data[':'] = .{ 0x04, 0x04, 0x00 }; // :
    data[';'] = .{ 0x04, 0x04, 0x80 }; // ;
    data['<'] = .{ 0x24, 0x84, 0x20 }; // <
    data['='] = .{ 0x0E, 0x0E, 0x00 }; // =
    data['>'] = .{ 0x84, 0x24, 0x80 }; // >
    data['?'] = .{ 0xE2, 0x40, 0x40 }; // ?
    data['@'] = .{ 0x4A, 0xEE, 0x80 }; // @ (simplified)

    // Uppercase A-Z
    data['A'] = .{ 0x4A, 0xEA, 0xA0 };
    data['B'] = .{ 0xCA, 0xCA, 0xC0 };
    data['C'] = .{ 0x68, 0x88, 0x60 };
    data['D'] = .{ 0xCA, 0xAA, 0xC0 };
    data['E'] = .{ 0xE8, 0xE8, 0xE0 };
    data['F'] = .{ 0xE8, 0xE8, 0x80 };
    data['G'] = .{ 0xE8, 0xAA, 0xE0 };
    data['H'] = .{ 0xAA, 0xEA, 0xA0 };
    data['I'] = .{ 0xE4, 0x44, 0xE0 };
    data['J'] = .{ 0x22, 0x2A, 0x40 };
    data['K'] = .{ 0xAA, 0xCA, 0xA0 };
    data['L'] = .{ 0x88, 0x88, 0xE0 };
    data['M'] = .{ 0xAE, 0xEA, 0xA0 };
    data['N'] = .{ 0xAE, 0xEE, 0xA0 };
    data['O'] = .{ 0x4A, 0xAA, 0x40 };
    data['P'] = .{ 0xEA, 0xE8, 0x80 };
    data['Q'] = .{ 0x4A, 0xAE, 0x60 };
    data['R'] = .{ 0xEA, 0xEC, 0xA0 };
    data['S'] = .{ 0x68, 0x42, 0xC0 };
    data['T'] = .{ 0xE4, 0x44, 0x40 };
    data['U'] = .{ 0xAA, 0xAA, 0xE0 };
    data['V'] = .{ 0xAA, 0xAA, 0x40 };
    data['W'] = .{ 0xAA, 0xEE, 0xA0 };
    data['X'] = .{ 0xAA, 0x4A, 0xA0 };
    data['Y'] = .{ 0xAA, 0x44, 0x40 };
    data['Z'] = .{ 0xE2, 0x48, 0xE0 };

    data['['] = .{ 0x64, 0x44, 0x60 }; // [
    data['\\'] = .{ 0x88, 0x44, 0x20 }; // backslash
    data[']'] = .{ 0xC4, 0x44, 0xC0 }; // ]
    data['^'] = .{ 0x4A, 0x00, 0x00 }; // ^
    data['_'] = .{ 0x00, 0x00, 0xE0 }; // _
    data['`'] = .{ 0x84, 0x00, 0x00 }; // `

    // Lowercase a-z (same glyphs as uppercase in PICO-8)
    data['a'] = .{ 0x4A, 0xEA, 0xA0 };
    data['b'] = .{ 0xCA, 0xCA, 0xC0 };
    data['c'] = .{ 0x68, 0x88, 0x60 };
    data['d'] = .{ 0xCA, 0xAA, 0xC0 };
    data['e'] = .{ 0xE8, 0xE8, 0xE0 };
    data['f'] = .{ 0xE8, 0xE8, 0x80 };
    data['g'] = .{ 0xE8, 0xAA, 0xE0 };
    data['h'] = .{ 0xAA, 0xEA, 0xA0 };
    data['i'] = .{ 0xE4, 0x44, 0xE0 };
    data['j'] = .{ 0x22, 0x2A, 0x40 };
    data['k'] = .{ 0xAA, 0xCA, 0xA0 };
    data['l'] = .{ 0x88, 0x88, 0xE0 };
    data['m'] = .{ 0xAE, 0xEA, 0xA0 };
    data['n'] = .{ 0xAE, 0xEE, 0xA0 };
    data['o'] = .{ 0x4A, 0xAA, 0x40 };
    data['p'] = .{ 0xEA, 0xE8, 0x80 };
    data['q'] = .{ 0x4A, 0xAE, 0x60 };
    data['r'] = .{ 0xEA, 0xEC, 0xA0 };
    data['s'] = .{ 0x68, 0x42, 0xC0 };
    data['t'] = .{ 0xE4, 0x44, 0x40 };
    data['u'] = .{ 0xAA, 0xAA, 0xE0 };
    data['v'] = .{ 0xAA, 0xAA, 0x40 };
    data['w'] = .{ 0xAA, 0xEE, 0xA0 };
    data['x'] = .{ 0xAA, 0x4A, 0xA0 };
    data['y'] = .{ 0xAA, 0x44, 0x40 };
    data['z'] = .{ 0xE2, 0x48, 0xE0 };

    data['{'] = .{ 0x24, 0x84, 0x20 }; // {
    data['|'] = .{ 0x44, 0x44, 0x40 }; // |
    data['}'] = .{ 0x84, 0x24, 0x80 }; // }
    data['~'] = .{ 0x5A, 0x00, 0x00 }; // ~

    break :init data;
};

/// Get pixel at (x, y) within a glyph. Returns true if pixel is set.
pub fn getPixel(char_code: u7, x: u3, y: u3) bool {
    if (x >= 4 or y >= 6) return false;
    const glyph = font_data[char_code];
    // Each byte holds 2 rows: high nibble = even row, low nibble = odd row
    const byte_idx: usize = y / 2;
    const nibble = if (y % 2 == 0) (glyph[byte_idx] >> 4) else (glyph[byte_idx] & 0x0F);
    // Bit 3 = leftmost pixel (x=0), bit 0 = rightmost pixel (x=3)
    return nibble & (@as(u4, 1) << (3 - @as(u2, @intCast(x)))) != 0;
}
